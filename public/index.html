<!DOCTYPE html>
<html lang="ko">

<head>
  <meta charset="UTF-8">
  <title>ë‚ ì”¨ ê¸°ë°˜ ì—¬í–‰ì§€ ì¶”ì²œ ì„œë¹„ìŠ¤</title>
  <link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css" />
  <style>

html, body {
  height: 100%;
}

  body {
    font-family: 'Malgun Gothic', sans-serif; /* ë§‘ì€ ê³ ë”• ì ìš© */
    margin: 0;
    padding: 0;
    background-color: #f8f9fa; /* ì—°í•œ ë°°ê²½ìƒ‰ */
    font-family: 'Noto Sans KR', sans-serif; /* ì „ì²´ í°íŠ¸ ë³€ê²½ */
  }

    h1, h2, h3 {
    font-family: 'Montserrat', sans-serif; /* ì œëª© í°íŠ¸ ë³€ê²½ */
  }
  /* í—¤ë” ìŠ¤íƒ€ì¼ */
  header {
    background: #fff; /* í°ìƒ‰ ë°°ê²½ */
    padding: 15px 20px;
    text-align: right;
    border-bottom: 1px solid #dee2e6; /* í•˜ë‹¨ ê²½ê³„ì„  */
  }

  header a {
    color: #007bff;
    text-decoration: none;
    font-weight: 500;
    margin-left: 15px;
    padding: 8px 12px;
    border: 1px solid #007bff;
    border-radius: 20px; /* ë‘¥ê·¼ ë²„íŠ¼ */
    transition: background-color 0.3s, color 0.3s;
  }

  header a:hover {
    background-color: #007bff;
    color: #fff;
  }

  /* í¼ ì»¨í…Œì´ë„ˆ ìŠ¤íƒ€ì¼ */
  #form-container {
    padding: 20px;
    background: #fff;
    margin: 20px auto;
    width: 90%;
    max-width: 600px;
    border-radius: 10px; /* ë‘¥ê·¼ ëª¨ì„œë¦¬ */
    box-shadow: 0 4px 8px rgba(0, 0, 0, 0.1); /* ê·¸ë¦¼ì íš¨ê³¼ */
    margin-top: 20px; /* í¼ ì»¨í…Œì´ë„ˆ ìœ„ ì—¬ë°± ì¶”ê°€ */
  }

  #form-container h1 {
    text-align: center;
    color: #343a40;
    margin-bottom: 20px;
  }

  .form-group {
    margin-bottom: 15px;
  }

  label {
    display: block;
    margin-bottom: 8px;
    color: #495057;
  }

  input,
  select {
    width: calc(100% - 18px); /* ì—¬ë°± ê³ ë ¤ */
    padding: 10px;
    border: 1px solid #ced4da;
    border-radius: 5px;
    box-sizing: border-box;
    transition: border-color 0.3s;
  }

  input:focus,
  select:focus {
    border-color: #007bff;
    outline: none;
  }

  button {
    background: #007bff;
    color: white;
    padding: 12px 20px;
    border: none;
    border-radius: 20px; /* ë‘¥ê·¼ ë²„íŠ¼ */
    cursor: pointer;
    font-size: 16px;
    transition: background-color 0.3s;
  }

  button:hover {
    background: #0056b3;
  }

  /* ì§€ë„ ìŠ¤íƒ€ì¼ */
  #map {
    width: 100%;
    height: calc(100vh - 200px); /* í—¤ë” ë° í¼ ë†’ì´ ê³ ë ¤ */
    border-radius: 15px; /* ì§€ë„ ëª¨ì„œë¦¬ ë‘¥ê¸€ê²Œ */
    overflow: hidden; /* ëª¨ì„œë¦¬ ë°–ìœ¼ë¡œ ë‚´ìš© ìˆ¨ê¹€ */
    margin: 20px auto; /* ê°€ìš´ë° ì •ë ¬ ë° ì—¬ë°± ì¶”ê°€ */
  }


  #review-modal,
#edit-review-modal {
  display: none; /* ì´ˆê¸°ì—ëŠ” ìˆ¨ê¹€ */
  position: fixed;
  top: 0;
  left: 0;
  width: 100%;
  height: 100%;
  background: rgba(0, 0, 0, 0.5);
  z-index: 9999;
  justify-content: center;
  align-items: center;
}


  #review-modal .modal-content,
  #edit-review-modal .modal-content {
    background: white;
    padding: 20px;
    border-radius: 10px;
    max-width: 600px;
    width: 80%;
    height: 100vh; /* ğŸ’¡ ì´ê±° ê¼­ í•„ìš”! */

    max-height: 80vh;
    overflow-y: auto;
  }

  #review-modal h2,
  #edit-review-modal h2 {
    color: #343a40;
    margin-bottom: 15px;
  }

  #review-list {
    border: 1px solid #dee2e6;
    padding: 10px;
    max-height: 300px;
    overflow-y: auto;
    margin-bottom: 20px;
    border-radius: 5px;
  }

  /* í›„ê¸° ëª©ë¡ì˜ ê° ì•„ì´í…œ ìŠ¤íƒ€ì¼ */
  #review-list .review-item {
    border-bottom: 1px solid #eee;
    padding: 10px 0;
  }

  #review-list .review-item:last-child {
    border-bottom: none;
  }

  #review-list .review-title {
    font-weight: bold;
    margin-bottom: 5px;
  }

  #review-list .review-content {
    margin-bottom: 5px;
  }

  #review-list .review-date,
  #review-list .review-author {
    font-size: 0.9em;
    color: #6c757d;
  }

  #review-modal .close-btn,
  #edit-review-modal .cancel-btn {
    background: #6c757d;
    color: white;
    border: none;
    padding: 10px 15px;
    border-radius: 5px;
    cursor: pointer;
    margin-top: 10px;
    transition: background-color 0.3s;
  }

  #review-modal .close-btn:hover,
  #edit-review-modal .cancel-btn:hover {
    background: #5a6268;
  }

  #edit-review-modal .edit-btn {
    background-color: #28a745;
    color: white;
    padding: 10px 20px;
    border: none;
    margin-right: 10px;
    cursor: pointer;
    font-size: 16px;
    border-radius: 5px;
  }

  #edit-review-modal .delete-btn {
    background-color: #dc3545;
    color: white;
    padding: 10px 20px;
    border: none;
    margin-right: 10px;
    cursor: pointer;
    font-size: 16px;
    border-radius: 5px;
  }

  /* í›„ê¸° ìˆ˜ì • í¼ ìŠ¤íƒ€ì¼ */
  #edit-review-modal input,
  #edit-review-modal textarea {
    width: calc(100% - 18px);
    padding: 10px;
    border: 1px solid #ced4da;
    border-radius: 5px;
    box-sizing: border-box;
    margin-bottom: 10px;
  }
  
 /* ë‚ ì”¨ ì •ë³´ ìŠ¤íƒ€ì¼ */
 #weather-info {
    background-color: white;
    padding: 20px;
    border-radius: 10px;
    box-shadow: 0 4px 8px rgba(0, 0, 0, 0.1);
    margin: 20px auto;
    width: 90%;
    max-width: 600px;
    text-align: center;
    display: flex; /* Flexbox ë ˆì´ì•„ì›ƒ ì ìš© */
    flex-direction: column; /* ìš”ì†Œë“¤ì„ ì„¸ë¡œë¡œ ë°°ì¹˜ */
    align-items: center; /* ê°€ìš´ë° ì •ë ¬ */
  }

  #weather-info b {
    margin-bottom: 5px;
    color: #333;
  }

  #weather-info span {
    font-weight: normal;
    color: #666;
  }

  /* ë‚ ì”¨ ì•„ì´ì½˜ ì»¨í…Œì´ë„ˆ */
  #weather-info .weather-icon-container {
    font-size: 3em; /* ì•„ì´ì½˜ í¬ê¸° */
    margin-bottom: 10px;
  }

  /* ë‚ ì”¨ ì•„ì´ì½˜ (ì˜ˆì‹œ) */
  #weather-info .weather-icon {
    display: inline-block; /* ì¸ë¼ì¸ ë¸”ë¡ ìš”ì†Œë¡œ ë³€ê²½ */
  }

  /* ë§‘ìŒ ì•„ì´ì½˜ */
  #weather-info .clear {
    color: #ffc107; /* ë…¸ë€ìƒ‰ */
  }

  /* íë¦¼ ì•„ì´ì½˜ */
  #weather-info .clouds {
    color: #999; /* íšŒìƒ‰ */
  }

  /* ë¹„ ì•„ì´ì½˜ */
  #weather-info .rain {
    color: #1e90ff; /* íŒŒë€ìƒ‰ */
  }

  /* ëˆˆ ì•„ì´ì½˜ */
  #weather-info .snow {
    color: #fff; /* í°ìƒ‰ */
    text-shadow: 1px 1px 2px #999;
  }

  /* ê¸°ì˜¨ ì•„ì´ì½˜ (ì˜ˆì‹œ) */
  #weather-info .temp-icon {
    font-size: 1.5em; /* ì•„ì´ì½˜ í¬ê¸° */
    margin-left: 5px;
    color: #f00; /* ë¹¨ê°„ìƒ‰ */
  }
</style>
</head>

<body>

  <!-- â”€â”€â”€â”€â”€â”€â”€â”€â”€ ìƒë‹¨ í—¤ë” (ë¡œê·¸ì¸ ë²„íŠ¼) â”€â”€â”€â”€â”€â”€â”€â”€â”€ -->
  <header>
    <a href="login.html">ë¡œê·¸ì¸</a>
  </header>

  <!-- ì¶”ì²œ í¼ -->
  <div id="form-container">
    <h1>ì—¬í–‰ì§€ ì¶”ì²œ ë°›ê¸°</h1>
    <div class="form-group">
      <label for="city">ë„ì‹œ ì„ íƒ:</label>
      <select id="city">
        <option value="ì„œìš¸">ì„œìš¸</option>
        <option value="ë¶€ì‚°">ë¶€ì‚°</option>
        <option value="ëŒ€êµ¬">ëŒ€êµ¬</option>
        <option value="ì¸ì²œ">ì¸ì²œ</option>
        <option value="ê´‘ì£¼">ê´‘ì£¼</option>
        <option value="ëŒ€ì „">ëŒ€ì „</option>
      </select>
    </div>
    <div class="form-group">
      <label for="datetime">ë‚ ì§œ ë° ì‹œê°„ ì„ íƒ:</label>
      <input type="datetime-local" id="datetime" />
    </div>
    <div class="form-group">
      <button id="getRecommendations">ì¶”ì²œ ë°›ê¸°</button>
    </div>
  </div>

  <!-- ë‚ ì”¨ ì •ë³´ í‘œì‹œ ì˜ì—­ -->
  <div id="weather-info" style="padding: 10px; font-size: 16px;"></div>

  <!-- ì§€ë„ í‘œì‹œ ì˜ì—­ -->
  <div id="map"></div>

  <!-- í›„ê¸° ëª¨ë‹¬ (í›„ê¸° ë³´ê¸°/ì‘ì„±) -->
  <div id="review-modal">
    <div class="modal-content">
      <h2>ê´€ê´‘ì§€ í›„ê¸°</h2>
    <!-- ê´€ê´‘ì§€ ì´ë¦„ í‘œì‹œ ì˜ì—­ ì¶”ê°€ -->
    <h3 id="destination-name"></h3>
    <div id="review-list">
      <!-- í•´ë‹¹ ê´€ê´‘ì§€ì˜ í›„ê¸° ëª©ë¡ì´ í‘œì‹œë©ë‹ˆë‹¤ -->
    </div>
      <h3>í›„ê¸° ì‘ì„±</h3>
      <form id="review-form">
        <!-- contentidëŠ” hidden í•„ë“œì— ì €ì¥ -->
        <input id="review-contentid" type="hidden">
        <div class="form-group">
          <label for="review-title">ì œëª©</label>
          <input type="text" id="review-title" required>
        </div>
        <div class="form-group">
          <label for="review-content">ë‚´ìš©</label>
          <textarea id="review-content" rows="3" required style="width:100%;"></textarea>
        </div>
        <button type="submit">ì‘ì„±</button>
      </form>
      <button class="close-btn" id="close-review-modal" style="margin-top:10px;">ë‹«ê¸°</button>
    </div>
  </div>

  <!-- í›„ê¸° ìˆ˜ì • ëª¨ë‹¬ -->
  <div id="edit-review-modal">
    <div class="modal-content">
      <h2>í›„ê¸° ìˆ˜ì •</h2>
      <form id="edit-review-form">
        <input type="hidden" id="edit-review-id">
        <div class="form-group">
          <label for="edit-review-title">ì œëª©</label>
          <input type="text" id="edit-review-title" required>
        </div>
        <div class="form-group">
          <label for="edit-review-content">ë‚´ìš©</label>
          <textarea id="edit-review-content" rows="3" required style="width:100%;"></textarea>
        </div>
        <button type="submit" class="edit-btn">ìˆ˜ì •</button>
        <button type="button" class="delete-btn" onclick="deleteReviewFromModal()">ì‚­ì œ</button>
        <button type="button" class="cancel-btn" onclick="closeEditReviewModal()">ì·¨ì†Œ</button>
      </form>
    </div>
  </div>

  <!-- Leaflet JS -->
  <script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"></script>
  <script>
    // ì§€ë„ ì´ˆê¸°í™”
    const map = L.map('map').setView([37.5665, 126.9780], 11);
    L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png', {
      attribution: '&copy; OpenStreetMap contributors'
    }).addTo(map);

    // ë§ˆì»¤ ë ˆì´ì–´
    const markerLayer = L.layerGroup().addTo(map);

    // ì¹´í…Œê³ ë¦¬ ë§¤í•‘
    const categoryMap = {
      "12": "ê´€ê´‘ì§€",
      "14": "ë¬¸í™”ì‹œì„¤",
      "15": "ì¶•ì œ/ê³µì—°/í–‰ì‚¬",
      "25": "ì—¬í–‰ì½”ìŠ¤",
      "28": "ë ˆí¬ì¸ ",
      "32": "ìˆ™ë°•",
      "38": "ì‡¼í•‘",
      "39": "ìŒì‹ì "
    };

    // ë„ì‹œë³„ ì¢Œí‘œ
    function getCityCoordinates(city) {
      switch (city) {
        case 'ì„œìš¸': return [37.5665, 126.9780];
        case 'ë¶€ì‚°': return [35.1796, 129.0756];
        case 'ëŒ€êµ¬': return [35.8714, 128.6014];
        case 'ì¸ì²œ': return [37.4563, 126.7052];
        case 'ê´‘ì£¼': return [35.1595, 126.8526];
        case 'ëŒ€ì „': return [36.3504, 127.3845];
        default: return [37.5665, 126.9780];
      }
    }

    // ì¶”ì²œ API í˜¸ì¶œ
    function getRecommendations() {
      const city = document.getElementById('city').value;
      const datetimeInput = document.getElementById('datetime').value;

      if (!datetimeInput) {
        alert('ë‚ ì§œì™€ ì‹œê°„ì„ ì„ íƒí•´ì£¼ì„¸ìš”.');
        return;
      }

      const datetime = datetimeInput;
      const [lat, lon] = getCityCoordinates(city);
      const apiUrl = `/api/recommendByForecast?lat=${lat}&lon=${lon}&datetime=${datetime}&city=${city}`;

      fetch(apiUrl)
        .then(res => res.json())
        .then(data => {
          // ë‚ ì”¨ ì •ë³´ í‘œì‹œ
          document.getElementById('weather-info').innerHTML = `
            <b>ì˜ˆë³´ ì‹œê°„:</b> ${data.forecast_time}<br/>
            <b>ë‚ ì”¨ ìƒíƒœ:</b> ${data.weather}<br/>
            <b>ê¸°ì˜¨:</b> ${data.temp.toFixed(1)}Â°C
          `;

          markerLayer.clearLayers();

          data.recommended_places.forEach(place => {
            const cat = categoryMap[place.category] || "ê¸°íƒ€";

            // ë§ˆìš°ìŠ¤ ì˜¤ë²„ì‹œ ì´ë¦„/í…Œë§ˆ í‘œì‹œ
            const minimalPopup = `<b>${place.name}</b><br/>í…Œë§ˆ: ${cat}`;
            const marker = L.marker([place.latitude, place.longitude]);

            marker.on('mouseover', function () {
              marker.bindTooltip(minimalPopup, { permanent: false }).openTooltip();
            });
            marker.on('mouseout', function () {
              marker.closeTooltip();
            });

            // í´ë¦­ ì‹œ ì´ë¯¸ì§€ + í›„ê¸° ë²„íŠ¼
            marker.on('click', function () {
              fetch(`/api/getImage?contentid=${place.contentid}`)
                .then(res => res.json())
                .then(imgData => {
                  const imageTag = imgData.imageUrl
                    ? `<img src="${imgData.imageUrl}" alt="${place.name}" style="width:220px; max-height:150px; margin-top:5px;" />`
                    : `<div style="margin-top:5px;">ì´ë¯¸ì§€ê°€ ì—†ìŠµë‹ˆë‹¤</div>`;
                  marker.bindPopup(
                    `<b>${place.name}</b><br/>
                     ì¹´í…Œê³ ë¦¬: ${cat}<br/>
                     ${imageTag}<br/>
                     <button onclick="openReviewModal('${place.contentid}')">í›„ê¸° ë³´ê¸°/ì‘ì„±</button>`
                  ).openPopup();
                })
                .catch(err => {
                  console.error('ì´ë¯¸ì§€ ì¡°íšŒ ì‹¤íŒ¨:', err);
                  marker.bindPopup(`<b>${place.name}</b><br/>í…Œë§ˆ: ${cat}<br/><button onclick="openReviewModal('${place.contentid}')">í›„ê¸° ë³´ê¸°/ì‘ì„±</button>`).openPopup();
                });
            });

            markerLayer.addLayer(marker);
          });

          map.setView([lat, lon], 12);
        })
        .catch(err => {
          console.error('ì¶”ì²œ API í˜¸ì¶œ ì‹¤íŒ¨:', err);
        });
    }

    // ë²„íŠ¼ ì´ë²¤íŠ¸
    document.getElementById('getRecommendations').addEventListener('click', getRecommendations);

    // ------------------------------
    // í›„ê¸°(ê²Œì‹œê¸€) ê´€ë ¨
    // ------------------------------

    // ëª¨ë‹¬ ì—´ê¸° (í›„ê¸° ë³´ê¸°/ì‘ì„±)
// ëª¨ë‹¬ ì—´ê¸° (í›„ê¸° ë³´ê¸°/ì‘ì„±) - ê´€ê´‘ì§€ ì´ë¦„ ê°€ì ¸ì˜¤ê¸° ì¶”ê°€
function openReviewModal(contentid) {
  console.log(contentid)
  const token = localStorage.getItem('token');
  if (!token) {
    alert('ë¡œê·¸ì¸ì´ í•„ìš”í•©ë‹ˆë‹¤.');
    return;
  }

    // ê´€ê´‘ì§€ ì´ë¦„ ê°€ì ¸ì˜¤ê¸°
    fetch(`/api/destinations/name/${contentid}`)
    .then(res => res.json())
    .then(data => {
      if (data.name) {
        document.getElementById('destination-name').textContent = data.name;
      } else {
        document.getElementById('destination-name').textContent = 'ì•Œ ìˆ˜ ì—†ëŠ” ê´€ê´‘ì§€';
      }
    })
    .catch(err => {
      console.error('ê´€ê´‘ì§€ ì •ë³´ ê°€ì ¸ì˜¤ê¸° ì‹¤íŒ¨:', err);
      document.getElementById('destination-name').textContent = '';
    });
  
  document.getElementById('review-modal').style.display = 'block';
  document.getElementById('review-contentid').value = contentid;


    document.getElementById('review-modal').style.display = 'flex'; // display: flexë¡œ ë³€ê²½
  document.getElementById('review-contentid').value = contentid;
  loadReviews(contentid);

  loadReviews(contentid);
}

    // ëª¨ë‹¬ ë‹«ê¸° (í›„ê¸° ë³´ê¸°/ì‘ì„±)
    document.getElementById('close-review-modal').addEventListener('click', () => {
      document.getElementById('review-modal').style.display = 'none';
    });

    // ê°„ë‹¨í•œ JWT íŒŒì‹±
    function parseJwt(token) {
      try {
        const base64Url = token.split('.')[1];
        const base64 = base64Url.replace(/-/g, '+').replace(/_/g, '/');
        return JSON.parse(decodeURIComponent(escape(window.atob(base64))));
      } catch (e) {
        return null;
      }
    }

    // í›„ê¸° ë¡œë“œ ë° ë Œë”ë§
    // í›„ê¸° ë¡œë“œ ë° ë Œë”ë§ ê°œì„ 
function loadReviews(contentid) {
  const token = localStorage.getItem('token');
  const currentUser = token ? parseJwt(token).email : null;

  // GET /articles?contentid=xxx
  fetch(`/articles?contentid=${contentid}`, {
    headers: { 'Authorization': 'Bearer ' + token }
  })
    .then(res => res.json())
    .then(data => {
      const reviewList = document.getElementById('review-list');
      reviewList.innerHTML = '';
      
      if (data.length === 0) {
        reviewList.innerHTML = '<p>ì‘ì„±ëœ í›„ê¸°ê°€ ì—†ìŠµë‹ˆë‹¤.</p>';
      } else {
        // í›„ê¸° ê°œìˆ˜ í‘œì‹œ
        const reviewCount = document.createElement('p');
        reviewCount.innerHTML = `<strong>ì´ ${data.length}ê°œì˜ í›„ê¸°ê°€ ìˆìŠµë‹ˆë‹¤.</strong>`;
        reviewList.appendChild(reviewCount);
        
        data.forEach(review => {
          const reviewItem = document.createElement('div');
          reviewItem.className = 'review-item';
          
          // í˜„ì¬ ë¡œê·¸ì¸í•œ ì‚¬ìš©ìì˜ í›„ê¸°ì¸ ê²½ìš° ìŠ¤íƒ€ì¼ ë³€ê²½
          if (currentUser && review.author === currentUser) {
            reviewItem.classList.add('editable');
            reviewItem.title = 'í´ë¦­í•˜ì—¬ ìˆ˜ì • ë˜ëŠ” ì‚­ì œ';
          }
          
          reviewItem.innerHTML = `
            <div class="review-title">${review.title}</div>
            <div class="review-date">${review.timestamp}</div>
            <div class="review-content">${review.content}</div>
            <div class="review-author">ì‘ì„±ì: ${review.author}</div>
          `;
          
          // ìì‹ ì˜ í›„ê¸°ë©´ í´ë¦­ ì‹œ ìˆ˜ì •/ì‚­ì œ ëª¨ë‹¬ ì—´ê¸°
          if (currentUser && review.author === currentUser) {
            reviewItem.addEventListener('click', () => {
              openEditReviewModal(review);
            });
          }

          reviewList.appendChild(reviewItem);
        });
      }
    })
    .catch(err => {
      console.error('í›„ê¸° ë¡œë“œ ì‹¤íŒ¨:', err);
      document.getElementById('review-list').innerHTML = '<p>í›„ê¸°ë¥¼ ë¶ˆëŸ¬ì˜¤ëŠ” ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤.</p>';
    });
}

    // í›„ê¸° ì‘ì„± (POST /articles)
// í›„ê¸° ì‘ì„± ì„±ê³µ ì‹œ í¼ ì´ˆê¸°í™” ë° ëª©ë¡ ìƒˆë¡œê³ ì¹¨
document.getElementById('review-form').addEventListener('submit', e => {
  e.preventDefault();
  const token = localStorage.getItem('token');
  if (!token) {
    alert('ë¡œê·¸ì¸ì´ í•„ìš”í•©ë‹ˆë‹¤.');
    return;
  }
  
  const contentid = document.getElementById('review-contentid').value;
  const title = document.getElementById('review-title').value;
  const content = document.getElementById('review-content').value;
  
  // ë²„íŠ¼ ë¹„í™œì„±í™” ë° ë¡œë”© ë©”ì‹œì§€
  const submitBtn = e.target.querySelector('button[type="submit"]');
  const originalText = submitBtn.textContent;
  submitBtn.disabled = true;
  submitBtn.textContent = 'ì‘ì„± ì¤‘...';
  
  fetch('/articles', {
    method: 'POST',
    headers: {
      'Content-Type': 'application/json',
      'Authorization': 'Bearer ' + token
    },
    body: JSON.stringify({ contentid, title, content })
  })
    .then(res => res.json())
    .then(data => {
      // ë²„íŠ¼ ì›ë˜ëŒ€ë¡œ ë³µêµ¬
      submitBtn.disabled = false;
      submitBtn.textContent = originalText;
      
      if (data.error) {
        alert('í›„ê¸° ì‘ì„± ì‹¤íŒ¨: ' + data.error);
      } else {
        alert('í›„ê¸° ì‘ì„± ì™„ë£Œ!');
        document.getElementById('review-form').reset();
        loadReviews(contentid);
      }
    })
    .catch(err => {
      // ë²„íŠ¼ ì›ë˜ëŒ€ë¡œ ë³µêµ¬
      submitBtn.disabled = false;
      submitBtn.textContent = originalText;
      
      console.error('í›„ê¸° ì‘ì„± ì˜¤ë¥˜:', err);
      alert('í›„ê¸° ì‘ì„± ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤.');
    });
});

    // ============== ìˆ˜ì •/ì‚­ì œ ëª¨ë‹¬ ê´€ë ¨ í•¨ìˆ˜ ==============

    // ëª¨ë‹¬ ì—´ê¸° (ìˆ˜ì •/ì‚­ì œ) â€“ í´ë¦­í•œ í›„ê¸°ì˜ ë°ì´í„°ë¥¼ ëª¨ë‹¬ì— ì±„ì›Œë„£ìŒ
    function openEditReviewModal(review) {
      document.getElementById('edit-review-id').value = review.id;
      document.getElementById('edit-review-title').value = review.title;
      document.getElementById('edit-review-content').value = review.content;
      document.getElementById('edit-review-modal').style.display = 'block';
    }

    // ìˆ˜ì •/ì‚­ì œ ëª¨ë‹¬ ë‹«ê¸°
    function closeEditReviewModal() {
      document.getElementById('edit-review-modal').style.display = 'none';
    }

    // ìˆ˜ì •/ì‚­ì œ ëª¨ë‹¬ ë‚´ ìˆ˜ì • í¼ ì œì¶œ ì‹œ (PUT /articles/:id)
    document.getElementById('edit-review-form').addEventListener('submit', function (e) {
      e.preventDefault();
      const reviewId = document.getElementById('edit-review-id').value;
      const newTitle = document.getElementById('edit-review-title').value;
      const newContent = document.getElementById('edit-review-content').value;
      const token = localStorage.getItem('token');

      fetch(`/articles/${reviewId}`, {
        method: 'PUT',
        headers: {
          'Content-Type': 'application/json',
          'Authorization': 'Bearer ' + token
        },
        body: JSON.stringify({ title: newTitle, content: newContent })
      })
        .then(res => res.json())
        .then(data => {
          if (data.error) {
            alert('ìˆ˜ì • ì‹¤íŒ¨: ' + data.error);
          } else {
            alert('ìˆ˜ì • ì™„ë£Œ!');
            closeEditReviewModal();
            const contentid = document.getElementById('review-contentid').value;
            loadReviews(contentid);
          }
        })
        .catch(err => {
          console.error('í›„ê¸° ìˆ˜ì • ì˜¤ë¥˜:', err);
          alert('í›„ê¸° ìˆ˜ì • ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤.');
        });
    });

    // ìˆ˜ì •/ì‚­ì œ ëª¨ë‹¬ ë‚´ ì‚­ì œ ë²„íŠ¼ í´ë¦­ ì‹œ (DELETE /articles/:id)
    function deleteReviewFromModal() {
      if (!confirm('ì •ë§ ì‚­ì œí•˜ì‹œê² ìŠµë‹ˆê¹Œ?')) return;
      const reviewId = document.getElementById('edit-review-id').value;
      const token = localStorage.getItem('token');

      fetch(`/articles/${reviewId}`, {
        method: 'DELETE',
        headers: { 'Authorization': 'Bearer ' + token }
      })
        .then(res => res.json())
        .then(data => {
          if (data.error) {
            alert('ì‚­ì œ ì‹¤íŒ¨: ' + data.error);
          } else {
            alert('ì‚­ì œ ì™„ë£Œ!');
            closeEditReviewModal();
            const contentid = document.getElementById('review-contentid').value;
            loadReviews(contentid);
          }
        })
        .catch(err => {
          console.error('í›„ê¸° ì‚­ì œ ì˜¤ë¥˜:', err);
          alert('í›„ê¸° ì‚­ì œ ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤.');
        });
    }
  </script>
</body>

</html>